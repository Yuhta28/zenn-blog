---
title: "ansible-benderã§ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã¿ãŸ"
emoji: "ğŸ"
type: "tech"
topics: ["ansible", "podman", "buildah", "ã‚³ãƒ³ãƒ†ãƒŠ"]
published: true
---

# æ¦‚è¦
ã“ã¡ã‚‰ã®å†…å®¹ã‚‚ä»¥å‰[noteã§æ›¸ã„ãŸè¨˜äº‹](https://note.com/tar28/n/n2479ab960187)ã‚’è¦‹ç›´ã—ã—ã¦ãƒªãƒ¡ã‚¤ã‚¯ã—ãŸã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚ã®æ™‚ã¯ã€ansible-benderã®å­¦ç¿’ã‚’ç›®çš„ã«ã—ã¦ãŠã‚Šã€å†…éƒ¨ã§å‹•ã„ã¦ã„ã‚‹Podmanã¨Buildahã«ã¤ã„ã¦ä½•ã‚‚çŸ¥ã‚‰ãªã„çŠ¶æ…‹ã§æ›¸ã„ã¦ã„ãŸã®ã§ã€è¦‹ç›´ã™ã¨å°‘ã—å¤‰ãªè¡¨ç¾ã‚‚ã‚ã‚Šã¾ã—ãŸã®ã§ã€ãƒªãƒ¡ã‚¤ã‚¯~~ã¨ã„ã†ã‚ˆã‚Šã‚‚ã†ä¸€åº¦æ›¸ãç›´~~ã—ã¦ã€ansible-benderã§ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã¿ãŸã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã«ç›´ã—ã¦æ›¸ãè¨˜ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
# ansible-benderã«ã¤ã„ã¦
ansible-benderã¯Ansible Playbookã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
https://github.com/ansible-community/ansible-bender
ã‹ã¤ã¦ã€ansible-containerã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã§Playbookã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†ã‚’å®Ÿç¾ã§ãã¾ã—ãŸãŒã€ç¾åœ¨ansible-containerã¯é–‹ç™ºãŒçµ‚äº†ã—ã¦ãŠã‚Šã¾ã™ã€‚
https://github.com/ansible/ansible-container
ansible-benderã¯ã€ansible-containerã®å¾Œç¶™æ©Ÿã¨ã—ã¦æ©Ÿèƒ½ã‚’å¼•ãç¶™ã„ã ãƒ„ãƒ¼ãƒ«ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
pipãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚
`pip install ansible-bender`
# æ©Ÿèƒ½
å…¬å¼ã®GitHubã®èª¬æ˜ã«æ›¸ã„ã¦ã‚ã‚‹ã¨ãŠã‚Šã§ã™ãŒã€è‡ªèº«ã®ç†è§£ã®ãŸã‚ã«ã„ãã¤ã‹ã‚’æ—¥æœ¬èªè¨³ã¨ã—ã¦è¨˜è¼‰ã—ã¾ã™ã€‚
- buildahã‚’ä½¿ã†ã“ã¨ã§ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã‚‹
- ãƒ“ãƒ«ãƒ‰ä¸­ã«ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ãƒã‚¦ãƒ³ãƒˆãŒå¯èƒ½
- ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§é«˜é€ŸåŒ–
- ã‚¿ã‚°`stop-layering`ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆã‚’æ­¢ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹
- ã‚¤ãƒ¡ãƒ¼ã‚¸ã®pushã‚’ã—ã¦ä»–ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚„docker daemonãªã©ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’é€ã‚‹ã“ã¨ãŒã§ãã‚‹

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰
ansible-benderã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

- `build` Playbookã‚’æŒ‡å®šã—ã¦æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
- `list-builds` ansible-benderã§ãƒ“ãƒ«ãƒ‰ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
- `get-logs` Playbookã‚’å®Ÿè¡Œã—ãŸã¨ãã®ãƒ­ã‚°ã‚’è¡¨ç¤º
- `inspect <ãƒ“ãƒ«ãƒ‰ID>` ãƒ“ãƒ«ãƒ‰å†…ã®è©³ç´°ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã€‚ãƒ“ãƒ«ãƒ‰IDã¯`list-builds`ã§å–å¾—å¯
- `push` ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä»–ã®å ´æ‰€ã¸é€ã‚‹
- `clean` ãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã«å­˜åœ¨ã—ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å‰Šé™¤
- `init` å¤‰æ•°ã®ç”¨æ„ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆPlaybookã‚’ä½œæˆ

```yaml:ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
---
- name: Containerized version of $project
  hosts: all
  vars:
    a_variable: value
    # configuration specific for ansible-bender
    ansible_bender:
      base_image: fedora:latest
      target_image:
        # command to run by default when invoking the container
        cmd: /command.sh
        name: $project
      working_container:
        volumes:
        # mount this git repo to the working container at /src
        - "{{ playbook_dir }}:/src"
  tasks:
  - name: install dependencies needed to run project $project
    package:
      name:
      - a_package
      - another_package
      state: present
```
# å¿…é ˆè¦ä»¶
å†’é ­ã§ã‚‚è¿°ã¹ãŸã‚ˆã†ã«ã€ansible-benderã¯podmanã¨buildahãŒå†…è”µã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚(å½“ãŸã‚Šå‰ã§ã™ãŒã€ansibleã‚‚å¿…è¦ã§ã™ã€‚)
ãã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹éš›ã€Pythonã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¿…è¦ã§ã™ã€‚ã“ã®æ™‚ã€Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯2ç³»ã§ã‚‚3ç³»ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚
ã“ã¡ã‚‰ã®æ–¹ãŒç´¹ä»‹ã—ã¦ã„ã‚‹Pythonã‚’å«ã‚€æœ€å°ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ãŠãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚[ansible-bender ã§ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹](https://qiita.com/tsuchm/items/90a49b827130f80f5e46)
```Docker:Dockerfile
FROM debian:buster

RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y python3 && apt-get clean
```
# ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ
ãã‚Œã§ã¯ansible-benderã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
ä½œæˆã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ãŒã€ä»¥å‰ç´¹ä»‹ã—ãŸNuxt.jsã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ansible-benderã§ä½œæˆã§ãã‚‹ã‹æ¤œè¨¼ã—ã¦ã„ãã¾ã™ã€‚
https://zenn.dev/yuta28/articles/37b2990f07d5643cfa56
ã¾ãŸãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€é€šå¸¸ã§ã—ãŸã‚‰ä¸Šã«æ›¸ã‹ã‚Œã¦ã„ã‚‹æœ€å°Pythonã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã‚ˆã„ã®ã§ã™ãŒã€ä»Šå›ã¯Nodeã‚’äº‹å‰ã«å…¥ã‚Œã¦ãŠããŸã„ã®ã§ã€ä»¥ä¸‹ã®Dockerfileã‚’åŸºã«ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

```Docker:Dockerfile
FROM node:latest
WORKDIR /app
RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y python3 rsync && apt-get clean
```
ã¡ãªã¿ã«ã€rsyncã‚’å…¥ã‚Œã¦ã„ã‚‹ã®ã¯ansibleã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚³ãƒ”ãƒ¼ã™ã‚‹ã®ã«ä¾¿åˆ©ãª`synchronize`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚
ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ãŒç”¨æ„ã§ãã¾ã—ãŸã‚‰ã€ç¶šã„ã¦ã¯æ§‹æˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚

```bash
â”œâ”€â”€ Prototype
â”‚   â””â”€â”€ app/(Nuxt.jsã®ã²ãªå‹)  
â””â”€â”€ build_nuxtimage.yml 
```
å‰å›ã¨åŒã˜ã‚ˆã†ã«äº‹å‰ã«Nuxt.jsã®ã²ãªå½¢ã¨ãªã‚‹å„ç¨®ä¸€å¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ç”¨æ„ã—ã¾ã™ã€‚
dockerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ä½œæˆã—ãŸã¨ãã¯Dockerfileã§ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã—ãŸãŒã€ansible-benderã§ã¯ã€Playbookã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã§ãã¾ã™ã®ã§ã€Dockerfileã¯ä»Šå›ä½œã£ã¦ãŠã‚Šã¾ã›ã‚“ã€‚
Playbookã®ä¸­èº«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```yaml:build_nuxtimage.yml
---
- name: Build Nuxt.js image
  hosts: all
  vars:
    ansible_bender:
      base_image: "localhost/node-python3"
      ansible_extra_args: "-vvv"
 
      target_image:
        name: yuta28/bender-test
        working_dir: /app
        environment: 
          NUXT_HOST: 0.0.0.0
        labels:
          built-by: '{{ ansible_user }}'
        cmd: "yarn run dev"        

  tasks:
  - name: Copy Prototype parts
    copy:
      src: "{{ item }}"
      dest: /app/
    with_items:
      - "{{ playbook_dir }}/Prototype/app/package.json"
      - "{{ playbook_dir }}/Prototype/app/yarn.lock"
  
  - name: Yarn install
    command: "yarn install"

  - name: Copy Prototype
    synchronize:
      src: "{{ playbook_dir }}/Prototype/app" 
      dest: /app

 ```

Dockerfileå†…ã®RUNå‘½ä»¤ç®‡æ‰€ã¯commandãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€COPYå‘½ä»¤ç®‡æ‰€ã¯synchronizeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€CMDå‘½ä»¤ã¯target_imageå†…ã®cmdå¤‰æ•°ã«å¤‰æ›ã—ã¦Playbookã§ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆæ–‡ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚
ä½œæˆå¾Œã€ansible-benderã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ã€‚`ansible-bender build build_nuxtimage.yml`
# å¤±æ•—
çµè«–ã‹ã‚‰è©±ã—ã¾ã™ã¨å¤±æ•—ã—ã¾ã—ãŸã€‚
ã‚¿ã‚¹ã‚¯`Copy Prototype`ã®ç®‡æ‰€ã§synchronizeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‡¦ç†ãŒçµ‚ã‚ã‚‰ãšã€å…ˆã«é€²ã¾ãªã„çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã€‚

```bash
task path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200912-021642705039-umrydddzeh.yaml:10
<yuta28-bender-test-20200912-021638690637-cont> ESTABLISH LOCAL CONNECTION FOR USER: ec2-user
<yuta28-bender-test-20200912-021638690637-cont> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1 `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/ansible-tmp-1599877156.9603715-28334-161050357341488 `" && echo ansible-tmp-1599877156.9603715-28334-161050357341488="` echo /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/ansible-tmp-1599877156.9603715-28334-161050357341488 `" ) && sleep 0'
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/synchronize.py
<yuta28-bender-test-20200912-021638690637-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/tmp8nv04tk7 TO /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/ansible-tmp-1599877156.9603715-28334-161050357341488/AnsiballZ_synchronize.py
<yuta28-bender-test-20200912-021638690637-cont> EXEC /bin/sh -c 'chmod u+x /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/ansible-tmp-1599877156.9603715-28334-161050357341488/ /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/ansible-tmp-1599877156.9603715-28334-161050357341488/AnsiballZ_synchronize.py && sleep 0'
<yuta28-bender-test-20200912-021638690637-cont> EXEC /bin/sh -c '/usr/bin/python3.6 /home/ec2-user/.ansible/tmp/ansible-local-24469ah1fy7m1/ansible-tmp-1599877156.9603715-28334-161050357341488/AnsiballZ_synchronize.py && sleep 0'
```

ã¯ã£ãã‚Šã¨ã—ãŸåŸå› ã¯æ´ã‚ã¾ã›ã‚“ãŒã€ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®é‡ãŒå¤šã„ã“ã¨ãŒåŸå› ã§ã¯ãªã„ã‹ã¨æ¨æ¸¬ã—ã¾ã—ãŸã€‚

```bash
$ ls -R app | wc -l
36358 â†3ä¸‡ä»¥ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤
```

ã©ã†ã—ãŸã‚‚ã®ã‹ã¨é€”æ–¹ã«ãã‚Œã¦ã„ãŸã¨ã“ã‚ã€ansibleã«è©³ã—ã„ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã®æ–¹ã‹ã‚‰å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ansibleã§ç›´æ¥é€ã‚‹ã®ã§ã¯ãªãã€AWS S3ã‚’çµŒç”±ã—ã¦é€ã£ãŸã»ã†ãŒã‚ˆã„ã¨ã„ã†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã„ãŸã ãã¾ã—ãŸã®ã§ã€[aws_s3](https://docs.ansible.com/ansible/latest/modules/aws_s3_module.html?highlight=aws_s3)ã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒansible-benderã§ä½¿ãˆã‚‹ã‹æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆç”¨Playbookã‚’ä½œæˆã—ã¾ã—ãŸã€‚

```YAML:build_nuxtimage.yml
---
- name: Build Nuxt.js image
  hosts: all
  gather_facts: false
  vars:
    ansible_python_interpreter: /usr/bin/python3
    ansible_bender:
      base_image: "localhost/node-python3"
      ansible_extra_args: "-vvv"

      target_image:
        name: yuta28/bender-test
        working_dir: /app
        environment: 
          NUXT_HOST: 0.0.0.0
        labels:
          built-by: '{{ ansible_user }}'      

  tasks:
  - name: Upload Prototype to S3
    aws_s3:
      bucket: ansible-bender-bucket
      object: app/nuxt.config.js
      src: "{{ playbook_dir }}/Prototype/app/nuxt.config.js"
      mode: put
```
ã“ã¡ã‚‰ã®Playbookã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚

```bash
TASK [Upload Prototype to S3] **********************************************************************************************************************************************************
task path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200912-024316468577-jjfznsazui.yaml:5
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'mount', b'--', b'yuta28-bender-test-20200912-024312325590-cont']
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200912-024312325590-cont', b'/bin/sh', b'-c', b'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir "` echo /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566 `" && echo ansible-tmp-1599878598.4473948-102621-228656985697566="` echo /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566 `" ) && sleep 0']
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200912-024312325590-cont', b'/bin/sh', b'-c', b'test -e /home/ec2-user/ansible-bender/simple-test/Prototype/app/nuxt.config.js && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/cloud/amazon/aws_s3.py
<yuta28-bender-test-20200912-024312325590-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-1025297iswwqko/tmpddey__6x TO /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566/AnsiballZ_aws_s3.py
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200912-024312325590-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566/ /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566/AnsiballZ_aws_s3.py && sleep 0']
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200912-024312325590-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566/AnsiballZ_aws_s3.py && sleep 0']
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200912-024312325590-cont', b'/bin/sh', b'-c', b'rm -f -r /tmp/ansible-tmp-1599878598.4473948-102621-228656985697566/ > /dev/null 2>&1 && sleep 0']
<yuta28-bender-test-20200912-024312325590-cont> RUN [b'buildah', b'umount', b'--', b'yuta28-bender-test-20200912-024312325590-cont']
fatal: [yuta28-bender-test-20200912-024312325590-cont]: FAILED! => {
    "changed": false,
    "invocation": {
        "module_args": {
            "aws_access_key": null,
            "aws_secret_key": null,
            "bucket": "ansible-bender-bucket",
            "debug_botocore_endpoint_logs": false,
            "dest": null,
            "dualstack": false,
            "ec2_url": null,
            "encrypt": true,
            "encryption_kms_key_id": null,
            "encryption_mode": "AES256",
            "expiry": 600,
            "headers": null,
            "ignore_nonexistent_bucket": false,
            "marker": "",
            "max_keys": 1000,
            "metadata": null,
            "mode": "put",
            "object": "app/nuxt.config.js",
            "overwrite": "always",
            "permission": [
                "private"
            ],
            "prefix": "",
            "profile": null,
            "region": null,
            "retries": 0,
            "rgw": false,
            "s3_url": null,
            "security_token": null,
            "src": "/home/ec2-user/ansible-bender/simple-test/Prototype/app/nuxt.config.js",
            "validate_certs": true,
            "version": null
        }
    },
    "msg": "Failed to import the required Python library (botocore or boto3) on ip-172-31-8-50.ap-northeast-1.compute.internal's Python /usr/bin/python3. Please read module documentation and install in the appropriate location. If the required library is installed, but Ansible is using the wrong Python interpreter, please consult the documentation on ansible_python_interpreter"
}
```
å¿…è¦ãªPythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¸è¶³ã—ã¦ã„ã‚‹ã¨å‡ºã¦ã„ã¾ã™ãŒã€boto3ã‚‚botocoreã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã•ã‚Œã¦ã„ã¾ã™ã€‚
`Python interpreter`ã®æŒ‡å®šãŒé–“é•ã£ã¦ã„ã‚‹ã®ã¨ã„ã†ã®ãŒã‚ˆãåˆ†ã‹ã‚‰ãšã€ä¸€å¿œå†’é ­ã§æ˜ç¤ºçš„ã«`ansible_python_interpreter: /usr/bin/python3`ã‚’æŒ‡å®šã—ã¾ã—ãŸãŒã€çµæœã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ã“ã¡ã‚‰ã®å†…å®¹ã¯teratailã«ã‚‚è³ªå•ã‚’æŠ•ç¨¿ã—ã¦ã„ã¾ã™ã®ã§ã€ã‚ã‹ã‚‹ã‹ãŸãŒã„ã¾ã—ãŸã‚‰ã”æ•™æˆãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
https://teratail.com/questions/291301
# ãƒ—ãƒ©ãƒ³B
æ¬¡ã«æŒ‘æˆ¦ã—ã¦ã¿ãŸã®ãŒã€appãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å±•é–‹ã™ã‚‹æ–¹æ³•ã§ã™ã€‚
Ansibleã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®åœ§ç¸®ã‚„å±•é–‹ã‚’å®Ÿæ–½ã—ã¦ãã‚Œã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã®ã§ã€ãã‚Œã‚’ä½¿ã„ã¾ã™ã€‚
[archive](https://docs.ansible.com/ansible/latest/modules/archive_module.html#archive-module)
[unarchive](https://docs.ansible.com/ansible/latest/modules/unarchive_module.html#unarchive-module)
ãã—ã¦å‡ºæ¥ä¸ŠãŒã£ãŸPlaybookãŒã“ã¡ã‚‰ã§ã™ã€‚

```YAML:build_nuxtimage.yml
---
- name: Build Nuxt.js image
  hosts: all
  gather_facts: false
  vars:
    ansible_python_interpreter: /usr/bin/python3
    ansible_bender:
      base_image: "localhost/node-python3"
      ansible_extra_args: "-vvv"

      target_image:
        name: yuta28/bender-test
        working_dir: /app
        environment:
          NUXT_HOST: 0.0.0.0
        labels:
          built-by: '{{ ansible_user }}'
        cmd: "yarn run dev"

  tasks:
  - name: Copy Prototype parts
    copy:
      src: "{{ item }}"
      dest: /app/
    with_items:
      - "{{ playbook_dir }}/Prototype/app/package.json"
      - "{{ playbook_dir }}/Prototype/app/yarn.lock"

  - name: Yarn install
    command: "yarn install"

  - name: Archive app directory
    delegate_to: localhost
    archive:
      path: "{{ playbook_dir }}/Prototype/app"
      dest: "{{ playbook_dir }}/Prototype/app.tar.gz"
      format: gz

  - name: Unpacks app.tar.gz
    unarchive:
      src: "{{ playbook_dir }}/Prototype/app.tar.gz"
      dest: /
```

archiveãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ãŒã€ãƒªãƒ¢ãƒ¼ãƒˆå…ˆã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ä¸Šã«ã‚ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹ã«ã¯ã€`delegate_to`ã§localhostã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã«ã‚ã‚‹appãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ãã¾ã™ã€‚
ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ãã¾ã—ãŸã‚‰ã€unarchiveãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚³ãƒ³ãƒ†ãƒŠå…ˆã«ã‚³ãƒ”ãƒ¼ã—ã¦å±•é–‹ã—ã¾ã™ã€‚ï¼ˆcopyã‚‚ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ä¾¿åˆ©ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã­ï¼‰
ã“ã®Playbookã‚’å®Ÿè¡Œã—ãŸçµæœãŒã“ã¡ã‚‰ã§ã™ã€‚

```bash
$ ansible-bender build build_nuxtimage.yml 
ansible-playbook 2.9.13
  config file = /tmp/ab_x4m8plk/ansible.cfg
  configured module search path = ['/home/ec2-user/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3.6/site-packages/ansible
  executable location = /usr/bin/ansible-playbook
  python version = 3.6.8 (default, Dec  5 2019, 15:45:45) [GCC 8.3.1 20191121 (Red Hat 8.3.1-5)]
Using /tmp/ab_x4m8plk/ansible.cfg as config file
host_list declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method
script declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method
auto declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method
Parsed /tmp/ab_x4m8plk/inventory inventory source with ini plugin

PLAYBOOK: .build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml *********************************************************************************************
1 plays in .build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml

PLAY [Build Nuxt.js image] ***********************************************************************************************************************************
META: ran handlers

TASK [Copy Prototype parts] **********************************************************************************************************************************
task path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml:5
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'mount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir "` echo /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493 `" && echo ansible-tmp-1599981579.9843893-85539-240769061862493="` echo /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493 `" ) && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/stat.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmptlan88hf TO /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/ /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/ansible-bender/simple-test/Prototype/app/package.json TO /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/source
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/ /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/source && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/copy.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmpsvj89bye TO /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_copy.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/ /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_copy.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_copy.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'rm -f -r /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/ > /dev/null 2>&1 && sleep 0']
changed: [yuta28-bender-test-20200913-071934769597-cont] => (item=/home/ec2-user/ansible-bender/simple-test/Prototype/app/package.json) => {
    "ansible_loop_var": "item",
    "changed": true,
    "checksum": "6d2c4a9be11c23a400eadada86083955716f1745",
    "dest": "/app/package.json",
    "diff": [],
    "gid": 0,
    "group": "root",
    "invocation": {
        "module_args": {
            "_original_basename": "package.json",
            "attributes": null,
            "backup": false,
            "checksum": "6d2c4a9be11c23a400eadada86083955716f1745",
            "content": null,
            "delimiter": null,
            "dest": "/app/package.json",
            "directory_mode": null,
            "follow": false,
            "force": true,
            "group": null,
            "local_follow": null,
            "mode": null,
            "owner": null,
            "regexp": null,
            "remote_src": null,
            "selevel": null,
            "serole": null,
            "setype": null,
            "seuser": null,
            "src": "/tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/source",
            "unsafe_writes": null,
            "validate": null
        }
    },
    "item": "/home/ec2-user/ansible-bender/simple-test/Prototype/app/package.json",
    "md5sum": "094ac03c6b1e84ee4acd6cdadd40b9d5",
    "mode": "0644",
    "owner": "root",
    "size": 485,
    "src": "/tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/source",
    "state": "file",
    "uid": 0
}
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir "` echo /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120 `" && echo ansible-tmp-1599981586.3151097-85539-278767227407120="` echo /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120 `" ) && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/stat.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmphc5g7kam TO /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/AnsiballZ_stat.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/ /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/AnsiballZ_stat.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/AnsiballZ_stat.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/ansible-bender/simple-test/Prototype/app/yarn.lock TO /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/source
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/ /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/source && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/copy.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmp_c7ux2zf TO /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/AnsiballZ_copy.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/ /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/AnsiballZ_copy.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/AnsiballZ_copy.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'rm -f -r /tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/ > /dev/null 2>&1 && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'umount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']
changed: [yuta28-bender-test-20200913-071934769597-cont] => (item=/home/ec2-user/ansible-bender/simple-test/Prototype/app/yarn.lock) => {
    "ansible_loop_var": "item",
    "changed": true,
    "checksum": "61b41c179bdef04f6f2825e48b0770043ff10c60",
    "dest": "/app/yarn.lock",
    "diff": [],
    "gid": 0,
    "group": "root",
    "invocation": {
        "module_args": {
            "_original_basename": "yarn.lock",
            "attributes": null,
            "backup": false,
            "checksum": "61b41c179bdef04f6f2825e48b0770043ff10c60",
            "content": null,
            "delimiter": null,
            "dest": "/app/yarn.lock",
            "directory_mode": null,
            "follow": false,
            "force": true,
            "group": null,
            "local_follow": null,
            "mode": null,
            "owner": null,
            "regexp": null,
            "remote_src": null,
            "selevel": null,
            "serole": null,
            "setype": null,
            "seuser": null,
            "src": "/tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/source",
            "unsafe_writes": null,
            "validate": null
        }
    },
    "item": "/home/ec2-user/ansible-bender/simple-test/Prototype/app/yarn.lock",
    "md5sum": "aff34cb85c63fed89b6999d3f0a52206",
    "mode": "0644",
    "owner": "root",
    "size": 437538,
    "src": "/tmp/ansible-tmp-1599981586.3151097-85539-278767227407120/source",
    "state": "file",
    "uid": 0
}

TASK [Yarn install] ******************************************************************************************************************************************
task path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml:9
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'mount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir "` echo /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220 `" && echo ansible-tmp-1599981625.6282134-86823-199173905670220="` echo /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220 `" ) && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmpzopf7c5d TO /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220/AnsiballZ_command.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220/ /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220/AnsiballZ_command.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220/AnsiballZ_command.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'rm -f -r /tmp/ansible-tmp-1599981625.6282134-86823-199173905670220/ > /dev/null 2>&1 && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'umount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']
changed: [yuta28-bender-test-20200913-071934769597-cont] => {
    "changed": true,
    "cmd": [
        "yarn",
        "install"
    ],
    "delta": "0:00:40.856951",
    "end": "2020-09-13 07:21:09.170809",
    "invocation": {
        "module_args": {
            "_raw_params": "yarn install",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": true
        }
    },
    "rc": 0,
    "start": "2020-09-13 07:20:28.313858",
    "stderr": "warning \" > bootstrap@4.5.2\" has unmet peer dependency \"jquery@1.9.1 - 3\".\nwarning \" > bootstrap@4.5.2\" has unmet peer dependency \"popper.js@^1.16.1\".\nwarning \"bootstrap-vue > portal-vue@2.1.7\" has unmet peer dependency \"vue@^2.5.18\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-async-generators@7.8.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-class-properties@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-json-strings@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-logical-assignment-operators@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-nullish-coalescing-operator@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-numeric-separator@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-object-rest-spread@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-optional-catch-binding@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-optional-chaining@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \" > @vue/test-utils@1.1.0\" has unmet peer dependency \"vue@2.x\".\nwarning \" > @vue/test-utils@1.1.0\" has unmet peer dependency \"vue-template-compiler@^2.x\".\nwarning \" > babel-core@7.0.0-bridge.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \" > babel-jest@26.3.0\" has unmet peer dependency \"@babel/core@^7.0.0\".\nwarning \"babel-jest > babel-preset-jest@26.3.0\" has unmet peer dependency \"@babel/core@^7.0.0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax@0.1.3\" has unmet peer dependency \"@babel/core@^7.0.0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-bigint@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-import-meta@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \" > vue-jest@3.0.6\" has unmet peer dependency \"vue@^2.x\".\nwarning \" > vue-jest@3.0.6\" has unmet peer dependency \"vue-template-compiler@^2.x\".",
    "stderr_lines": [
        "warning \" > bootstrap@4.5.2\" has unmet peer dependency \"jquery@1.9.1 - 3\".",
        "warning \" > bootstrap@4.5.2\" has unmet peer dependency \"popper.js@^1.16.1\".",
        "warning \"bootstrap-vue > portal-vue@2.1.7\" has unmet peer dependency \"vue@^2.5.18\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-async-generators@7.8.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-class-properties@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-json-strings@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-logical-assignment-operators@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-nullish-coalescing-operator@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-numeric-separator@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-object-rest-spread@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-optional-catch-binding@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-optional-chaining@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \" > @vue/test-utils@1.1.0\" has unmet peer dependency \"vue@2.x\".",
        "warning \" > @vue/test-utils@1.1.0\" has unmet peer dependency \"vue-template-compiler@^2.x\".",
        "warning \" > babel-core@7.0.0-bridge.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \" > babel-jest@26.3.0\" has unmet peer dependency \"@babel/core@^7.0.0\".",
        "warning \"babel-jest > babel-preset-jest@26.3.0\" has unmet peer dependency \"@babel/core@^7.0.0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax@0.1.3\" has unmet peer dependency \"@babel/core@^7.0.0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-bigint@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \"babel-jest > babel-preset-jest > babel-preset-current-node-syntax > @babel/plugin-syntax-import-meta@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".",
        "warning \" > vue-jest@3.0.6\" has unmet peer dependency \"vue@^2.x\".",
        "warning \" > vue-jest@3.0.6\" has unmet peer dependency \"vue-template-compiler@^2.x\"."
    ],
    "stdout": "yarn install v1.22.5\n[1/4] Resolving packages...\n[2/4] Fetching packages...\ninfo fsevents@2.1.3: The platform \"linux\" is incompatible with this module.\ninfo \"fsevents@2.1.3\" is an optional dependency and failed compatibility check. Excluding it from installation.\ninfo fsevents@1.2.13: The platform \"linux\" is incompatible with this module.\ninfo \"fsevents@1.2.13\" is an optional dependency and failed compatibility check. Excluding it from installation.\n[3/4] Linking dependencies...\n[4/4] Building fresh packages...\nDone in 40.62s.",
    "stdout_lines": [
        "yarn install v1.22.5",
        "[1/4] Resolving packages...",
        "[2/4] Fetching packages...",
        "info fsevents@2.1.3: The platform \"linux\" is incompatible with this module.",
        "info \"fsevents@2.1.3\" is an optional dependency and failed compatibility check. Excluding it from installation.",
        "info fsevents@1.2.13: The platform \"linux\" is incompatible with this module.",
        "info \"fsevents@1.2.13\" is an optional dependency and failed compatibility check. Excluding it from installation.",
        "[3/4] Linking dependencies...",
        "[4/4] Building fresh packages...",
        "Done in 40.62s."
    ]
}

TASK [Archive app directory] *********************************************************************************************************************************
task path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml:10
<localhost> ESTABLISH LOCAL CONNECTION FOR USER: ec2-user
<localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /tmp `"&& mkdir "` echo /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194 `" && echo ansible-tmp-1599981718.3019533-89318-73459036901194="` echo /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194 `" ) && sleep 0'
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/archive.py
<localhost> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmpai8exkec TO /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194/AnsiballZ_archive.py
<localhost> EXEC /bin/sh -c 'chmod u+x /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194/ /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194/AnsiballZ_archive.py && sleep 0'
<localhost> EXEC /bin/sh -c '/usr/bin/python3 /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194/AnsiballZ_archive.py && sleep 0'
<localhost> EXEC /bin/sh -c 'rm -f -r /tmp/ansible-tmp-1599981718.3019533-89318-73459036901194/ > /dev/null 2>&1 && sleep 0'
changed: [yuta28-bender-test-20200913-071934769597-cont] => {
    "archived": [
        "/home/ec2-user/ansible-bender/simple-test/Prototype/app/.babelrc",
        "/home/ec2-user/ansible-bender/simple-test/Prototype/app/.editorconfig",
        "/home/ec2-user/ansible-bender/simple-test/Prototype/app/.gitignore",
        "/home/ec2-user/ansible-bender/simple-test/Prototype/app/README.md",
ã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œçœç•¥ã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œ

TASK [Unpacks app.tar.gz] ************************************************************************************************************************************
task path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml:14
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'mount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir "` echo /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779 `" && echo ansible-tmp-1599981807.6501725-89365-211504907263779="` echo /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779 `" ) && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/stat.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmpme8oa0lm TO /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/AnsiballZ_stat.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/ /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/AnsiballZ_stat.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/AnsiballZ_stat.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/ansible-bender/simple-test/Prototype/app.tar.gz TO /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/source
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/ /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/source && sleep 0']
Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/unarchive.py
<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmppn591my3 TO /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/AnsiballZ_unarchive.py
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/ /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/AnsiballZ_unarchive.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/AnsiballZ_unarchive.py && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'rm -f -r /tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/ > /dev/null 2>&1 && sleep 0']
<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'umount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']
changed: [yuta28-bender-test-20200913-071934769597-cont] => {
    "changed": true,
    "dest": "/",
    "extract_results": {
        "cmd": [
            "/bin/tar",
            "--extract",
            "-C",
            "/",
            "-z",
            "-f",
            "/tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/source"
        ],
        "err": "",
        "out": "",
        "rc": 0
    },
    "gid": 0,
    "group": "root",
    "handler": "TgzArchive",
    "invocation": {
        "module_args": {
            "attributes": null,
            "backup": null,
            "content": null,
            "creates": null,
            "delimiter": null,
            "dest": "/",
            "directory_mode": null,
            "exclude": [],
            "extra_opts": [],
            "follow": false,
            "force": null,
            "group": null,
            "keep_newer": false,
            "list_files": false,
            "mode": null,
            "owner": null,
            "regexp": null,
            "remote_src": false,
            "selevel": null,
            "serole": null,
            "setype": null,
            "seuser": null,
            "src": "/tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/source",
            "unsafe_writes": null,
            "validate_certs": true
        }
    },
    "mode": "0755",
    "owner": "root",
    "size": 39,
    "src": "/tmp/ansible-tmp-1599981807.6501725-89365-211504907263779/source",
    "state": "directory",
    "uid": 0
}
META: ran handlers
META: ran handlers

PLAY RECAP ***************************************************************************************************************************************************
yuta28-bender-test-20200913-071934769597-cont : ok=4    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Getting image source signatures
Copying blob sha256:b323b70996e4f6d603c331669ac44cf6234a2e22002d3686e9c88398c6911c25
Copying blob sha256:e8847c2734e1bec913fbb00dbd638e9bff6c42f699bbeb897728e234cf1a6e72
Copying blob sha256:a4c504f73441d711e6e71e5c177a772efe4d500c2d97b2a1358ea65edc98e8d5
Copying blob sha256:ef5de533cb53783465669a60fc9b0b1c782d319c5c8991fe9868f3be8be8e58b
Copying blob sha256:cbe6bbd0c86ff46f87950e109e891445a085c9bbf5af737b0ae3871d782e5335
Copying blob sha256:174e334f3f463272eeba0021b8b2c54a8891abc0c74201bbd98e87e8c00524e2
Copying blob sha256:e404bec46f40991019fbf239256326c48afb7672768755740a6ba862d431e5c6
Copying blob sha256:58b4b808347b3cdc40003e905f03059f37ae8cf169e91ecf25250e475e27728f
Copying blob sha256:24a8e30559a7f9f31238761563cc4ab907863039cbc3778449ca8c55f50ecc4a
Copying blob sha256:9b6e6b48454d80e68f9709e8b82abfe7bd0d059464b9c1796d462601ea59182f
Copying blob sha256:9f9869f02922117d69ea1b18239a9d55ac8e6d4ca578fc7ef226d20c3e7424f2
Copying config sha256:ddcc7b1e45f6483f9df7f0d19a17969aa27f92f2e6f77962d3c87c29f32c8186
Writing manifest to image destination
Storing signatures
ddcc7b1e45f6483f9df7f0d19a17969aa27f92f2e6f77962d3c87c29f32c8186
Image 'yuta28/bender-test' was built successfully \o/

$ podman images
REPOSITORY                     TAG      IMAGE ID       CREATED          SIZE
localhost/yuta28/bender-test   latest   ddcc7b1e45f6   32 minutes ago   1.41 GB
localhost/node-python3         latest   79003b61771b   3 hours ago      990 MB
docker.io/library/node         latest   173eeb895217   2 days ago       972 MB

```

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸`localhost/yuta28/bender-teat`ãŒä½œæˆã•ã‚Œã¾ã—ãŸã®ã§ã€èµ·å‹•ã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
$ podman run --rm -it -p 8080:3000 localhost/yuta28/bender-test:latest
yarn run v1.22.5
$ nuxt

 WARN  mode option is deprecated. You can safely remove it from nuxt.config                                                                                                          07:59:19


   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â”‚                                        â”‚
   â”‚   Nuxt.js @ v2.14.5                    â”‚
   â”‚                                        â”‚
   â”‚   â–¸ Environment: development           â”‚
   â”‚   â–¸ Rendering:   server-side           â”‚
   â”‚   â–¸ Target:      server                â”‚
   â”‚                                        â”‚
   â”‚   Listening: http://10.0.2.100:3000/   â”‚
   â”‚                                        â”‚
   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â„¹ Preparing project for development                                                                                                                                                  07:59:21
â„¹ Initial build may take a while                                                                                                                                                     07:59:21
âœ” Builder initialized                                                                                                                                                                07:59:21
âœ” Nuxt files generated                                                                                                                                                               07:59:21

âœ” Client
  Compiled successfully in 8.21s

âœ” Server
  Compiled successfully in 6.60s

â„¹ Waiting for file changes                                                                                                                                                           07:59:30
â„¹ Memory usage: 212 MB (RSS: 320 MB)                                                                                                                                                 07:59:30
â„¹ Listening on: http://10.0.2.100:3000/                                                                                                                                              07:59:30

```

```bash
 $ podman ps
CONTAINER ID  IMAGE                                COMMAND       CREATED         STATUS             PORTS                   NAMES
fe83f066139c  localhost/yuta28/bender-test:latest  yarn run dev  12 minutes ago  Up 12 minutes ago  0.0.0.0:8080->3000/tcp  strange_moore
```

![](/images/ansible-bender/image1.png)

ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã§ãã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰Nuxt.jsã®ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸã€‚
# åçœç‚¹
Dockerfileã‹ã‚‰Playbookã¸å¤‰æ›´ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆã‚’è¡Œã„ã¾ã—ãŸãŒã€ã„ãã¤ã‹ã‚„ã‚Šæ–¹ãŒåˆ†ã‹ã‚‰ãšã€æ®‹ã‚¿ã‚¹ã‚¯ã¨ã—ã¦æ®‹ã£ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

#### telemetryã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åé›†å•ã„åˆã‚ã›ã®ç„¡åŠ¹åŒ–è¨­å®šã«ã¤ã„ã¦
Dockerfileã§ã¯ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã—ãŸã€‚
`NUXT_TELEMETRY_DISABLED=1`
ã“ã¡ã‚‰ã§ã™ãŒã€Nuxtæ©Ÿèƒ½ã®çµ±è¨ˆæƒ…å ±ã®åé›†å•ã„åˆã‚ã›ã‚’ç„¡è¦–ã™ã‚‹è¨­å®šã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯æœ‰åŠ¹åŒ–ã•ã‚Œã¦ãŠã‚Šã€æœ€åˆã«ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ãã¾ã™ã€‚

```bash
yarn run v1.22.5
$ nuxt

â„¹ NuxtJS collects completely anonymous data about usage.                                                                                                      11:21:11
  This will help us improving Nuxt developer experience over the time.
  Read more on https://git.io/nuxt-telemetry

? Are you interested in participation? Yes â† Yes/Noã§é¸æŠ
```

èµ·å‹•ã®ãŸã³ã«èã‹ã‚Œã‚‹ã®ãŒç…©ã‚ã—ã„ã®ã§è¨­å®šã§ç„¡åŠ¹åŒ–ã—ã‚ˆã†ã¨ã€å¤‰æ•°ã‚’Playbookã«çµ„ã¿è¾¼ã¿ã¾ã—ãŸãŒã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦å¤±æ•—ã—ã¾ã—ãŸã€‚

```bash
$ ansible-bender build simple-test/build_nuxtimage.yml 
There was an error during execution: variable /target_image/environment/NUXT_TELEMETRY_DISABLED is set to 1, which is not of type string
```
ç’°å¢ƒå¤‰æ•°ãŒstringå‹ã§ãªã„ã¨æ€’ã‚‰ã‚Œã¾ã—ãŸã€‚`NUXT_TELEMETRY_DISABLED`ã¯booleanå‹ã§ã™ãŒã€ansible-benderã®ç’°å¢ƒå¤‰æ•°ã¯stringå‹ã®ã‚‚ã®ã—ã‹ã‚»ãƒƒãƒˆã§ããªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
å¯¾å‡¦æ–¹æ³•ã¨ã—ã¾ã—ã¦ã¯ã€`app/nuxt.config.js`å†…ã«ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

```javascript:nuxt.config.js
export default {
~~~~~æœ«å°¾è¿½åŠ ~~~~~
  telemetry: false
}
```

#### noneã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæºœã¾ã‚Šç¶šã‘ã‚‹
Playbookå®Ÿè¡Œç›´å¾Œã«ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’èª¿ã¹ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«é€”ä¸­éç¨‹ã§ä½œã‚‰ã‚ŒãŸnoneã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãŸãã•ã‚“æºœã¾ã£ã¦ãã¾ã™ã€‚

```bash
$ podman images
REPOSITORY                     TAG        IMAGE ID       CREATED       SIZE
localhost/yuta28/bender-test   latest     3b568629853d   2 hours ago   1.41 GB
<none>                         <none>     30f38e724bd8   2 hours ago   1.41 GB
<none>                         <none>     2c3401135802   2 hours ago   1.41 GB
<none>                         <none>     ab36ebfbcb82   2 hours ago   1.41 GB
<none>                         <none>     0c15be92f176   2 hours ago   992 MB
<none>                         <none>     0f4f0464e1e9   2 hours ago   992 MB
<none>                         <none>     f19ac9e8da69   2 hours ago   991 MB
localhost/node-python3         latest     73bb42b858aa   5 days ago    991 MB
localhost/debian-python3       buster     af956b4f0450   8 days ago    177 MB
docker.io/library/node         latest     40ce906a3734   11 days ago   973 MB
docker.io/library/python       3-alpine   44fceb565b2a   4 weeks ago   44.7 MB
docker.io/library/debian       buster     ee11c54e6bb7   5 weeks ago   119 MB
```

ä½œæˆå¾Œã«`podman image prune`ã§æ¶ˆã—ã¦ã„ã¾ã™ãŒã€ã“ã®è¾ºãªã‚“ã¨ã‹ãªã‚‰ãªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```bash
$ podman image prune 
f19ac9e8da698db6fc77e469a24e7e1fa078e595338cf6b6f99961b1f2cb375d
0f4f0464e1e9ec409b6359bce2c8c4bf892dd592f01d1361d2807afd811ef9f0
0c15be92f176a7c52b7d43b664f60714b07e8955bc544bea732e9dc33ae25d4a
ab36ebfbcb829a626919ed45155b82be8e885c5fc82d91c86e910ac6173b4fb4
2c340113580260ccac3b2bfa7341927f6faba8355b21d6e2893556eed4161e99
30f38e724bd8c9af6ce74fe7eb733181e97c7ee77dc6c3b6a593853a6fa70f28
$ podman images
REPOSITORY                     TAG        IMAGE ID       CREATED       SIZE
localhost/yuta28/bender-test   latest     3b568629853d   2 hours ago   1.41 GB
localhost/node-python3         latest     73bb42b858aa   5 days ago    991 MB
localhost/debian-python3       buster     af956b4f0450   8 days ago    177 MB
docker.io/library/node         latest     40ce906a3734   11 days ago   973 MB
docker.io/library/python       3-alpine   44fceb565b2a   4 weeks ago   44.7 MB
docker.io/library/debian       buster     ee11c54e6bb7   5 weeks ago   119 MB
```

# æ‰€æ„Ÿ
ansible-benderã‚’ä½¿ã£ãŸæ„Ÿæƒ³ã¨ã—ã¦ã¯æ€ã£ãŸã‚ˆã‚Šã‚‚ä½¿ã„ã«ãã„ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
ansible-containerã¯ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒƒã‚·ãƒ¥ãŒã§ããŸã®ã§ã™ãŒã€ansible-benderã¯ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã ã‘ã«ç•™ã¾ã£ã¦ãŠã‚Šã€æ©Ÿèƒ½ã¨ã—ã¦ã¯æ¸›ã£ãŸã‚ˆã†ã«æ„Ÿã˜ã¾ã™ã€‚
ã¾ãŸã€ansible-benderã®é–‹ç™ºã¯ã‚ã¾ã‚Šæ´»ç™ºã§ã¯ãªãã€æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ãŒæ˜¨å¹´ã®12æœˆã€ãƒ—ãƒ«ãƒªã‚¯ã‚‚ä»Šå¹´ã®5/18ãŒæœ€å¾Œã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚(2020/9ç¾åœ¨)
æ­£ç›´ãªã¨ã“ã‚Ansibleã§ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã¾ã‚Šæ„Ÿã˜ã‚‰ã‚Œãšã€docker-composeã‚„Kubernetesã§ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†ã‚’ã—ãŸã»ã†ãŒã„ã„ã˜ã‚ƒã‚“ã¨è¨€ã‚ã‚ŒãŸã‚‰ä½•ã‚‚è¨€ãˆã¾ã›ã‚“ã€‚
Ansibleã§ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚„ansible-benderãŒä¸Šè¨˜2ã¤ã‚ˆã‚Šã‚‚å„ªã‚Œã¦ã„ã‚‹ç‚¹ãŒã‚ã‚Šã¾ã—ãŸã‚‰ãœã²ã¨ã‚‚ã‚³ãƒ¡ãƒ³ãƒˆã«ã¦ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

### LTè³‡æ–™
ã“ã®è¨˜äº‹ã‚’åŸºã«ã—ãŸLTã‚’ã—ã¾ã—ãŸã®ã§è³‡æ–™ã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚
@[speakerdeck](c53f644bc02547c8b53e660364dc51a1)