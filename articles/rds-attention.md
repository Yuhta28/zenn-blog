---
title: "RDSのリザーブドインスタンスに気をつけよう"
emoji: "🐁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS","RDS"]
published: false
---

# 背景
会社で動かしているAWSインスタンスのRIが6/25に期限が切れるとお知らせがありましたので、5月ごろからEC2インスタンスやRDSの棚卸し作業を行っていました。

その時にRDSのリザーブドインスタンス(RI)に関する注意点、もとい私がやらかした失敗談です。
EC2のRIとは微妙に仕様が異なっていて罠にハマりましたので戒めの意味を込めてここに記します。

# EC2リザーブドインスタンスとSavings Plansについて
表題から主旨が外れますが、せっかくなのでEC2インスタンスのコスト削減について説明します。

昨年会社ではEC2インスタンスはすべてRIを使って年間のランニングコスト削減に努めていました。
ところが弊社では、EC2インスタンスタイプを頻繁に変えて、作っては壊してを繰り返しておりインスタンスタイプが固定されるリザーブドインスタンスではあまりコスト削減効果が見込めませんでした。
https://aws.amazon.com/jp/ec2/pricing/reserved-instances/
そこで今年からより柔軟に対象インスタンスを変えられるSavings Plans(SP)に変更することに決めました。
https://aws.amazon.com/jp/savingsplans/
RIは指定されたリージョンとインスタンスタイプにしか割引が適用されませんが、SPは時間あたりの使用量に応じて事前に先払いする仕組みとなっています。
例えば一時間あたり$0.0199を1年間分全額先払い(≒$175.2)すれば、オンデマンドですと$0.0272かかる東京リージョンのt3.smallインスタンス1台を1年間利用できるという計算です。[^1]
|インスタンス名|Savings Plans の料金|オンデマンドと比較した費用節減|オンデマンド料金|リージョン|OS|
|----|----|----|----|----|----|
|t3.small|	0.0199 USD	|27%	|0.0272 USD	|Asia Pacific (Tokyo)	|Linux|
[^1]: https://aws.amazon.com/jp/savingsplans/compute-pricing/

ここでRIと違う点はコンピューティングリソースに対して事前に先払いするという点です。
RIでは東京リージョンのt3.smallインスタンス1台と指定するとその割引が東京リージョンのt3.smallインスタンス1台にしか有効となりません。
SPではt3.smallの半分のコストであるt3.micro2台分に対しても割引を利かせることも可能となります。

#### AWSに$0.0199申請した場合の割引適用インスタンス台数と期間[^2]
|t3.micro|t3.small|t3.medium|
|----|----|----|
| 2台*1年| 1台*1年| 1台*半年|
[^2]: 東京リージョンの場合

4月頃から会社で動かしているWebサーバーのインスタンスタイプをt3.mediumからt3.smallに移行している段階でしたので、インスタンスタイプが変更されても割引が効くSPの方が弊社にちょうどよかったことになります。

また弊社は7月から期初となりますので、新年度の予算にAWSのコストを計上したいというマネージャーの要望のもと適用日を6/26からではなく7/1に変更しました。
EC2インスタンスのRIとSPは申請日に即日反映させる以外にも先の日付を指定して請求とプラン開始日を変更できます。
![](https://storage.googleapis.com/zenn-user-upload/7777b5a22a7248dea6703665.png)
![](https://storage.googleapis.com/zenn-user-upload/4cbce4c211ec865c53f01362.png)

大分話が脱線しましたが、EC2インスタンスのコスト最適化はこれで問題なく完了しましたので次はRDSのRIも同じように7/1適用で申請しようとしました。

# RDSのRIについて
RDSもEC2インスタンスと同じように6/25で期限が切れますが、7/1に適用させるために適用日付を変更して申請しようとしました。
ところが、RDSのRIには日付の選択オプションがなくて、私は次の画面で選択できるのかなと思い、このまま送信ボタンを押してしまいました。
![](https://storage.googleapis.com/zenn-user-upload/e66d29867f78eb7c8b2b217e.png)