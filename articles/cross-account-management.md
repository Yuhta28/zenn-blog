---
title: "AWSマルチアカウント管理で気になること"
emoji: "🐁"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["AWS","IAM","設計"]
published: false
---
# 概要
業務でAWSのマルチアカウント管理の設計を担当していますが、疑問に思った点があり記事として書き上げました。
私の考えは述べますが、正解がわからないのでAWSのマルチアカウント管理について詳しい知見をお持ちの人がいましたらアドバイスを頂けますと幸いです。

# マルチアカウント管理
まず始めに複数のAWSアカウントを管理する場合の課題についてお話しします。
以下のように本番、ステージング、検証とそれぞれ別途AWSアカウントを分けており個別にアカウント(IAMユーザー)を持っていると仮定します。
AWSはあるアカウントにログインした場合、同じブラウザで他のアカウントにログインしようとする場合、今ログインしているアカウントからログアウトしてもう一度ログインし直さないといけません。

![](/images/cross-account-management/image1.png)

さらにAWSのログインにMFA(multi-factor authentication)を必須とした場合、毎回自分のスマホから、MFAアプリを起動してワンタイムパスワードを入力するという手間が生じます。
弊社でもこの運用でかなり面倒という気持ちがありました。

ほかにもこのように各AWSアカウントにそれぞれIAMユーザーを登録して運用することに以下の問題点があります。

- 権限変更や退職に伴うユーザー削除が発生する場合、各アカウントごとに同じ操作を実施する必要がある
- アカウントごとにクレデンシャル情報を個々人に管理してもらうことになり、管理の手間が嵩む

これらを解決するためにIAMロールによるクロスアカウントアクセスを活用することでIAMユーザーの一元管理を実現します。

# クロスアカウントアクセス
クロスアカウントアクセスでは以下のようにジャンプアカウントとよばれるほかのAWSアカウントへスイッチするための踏み台アカウントにユーザーはログインし、そこから複数AWSアカウントにスイッチしてマルチアカウント管理を実現する設計です。
![](/images/cross-account-management/image2.png)

ジャンプアカウントにIAMユーザーを登録し、それぞれのアカウントにはIAMロールを作成します。
このIAMロールには今までのIAMユーザーで操作できたIAMポリシーと同じポリシーを付与することでユーザーに今までと同じ操作ができるようにします。

# 疑問点
詳細な実装方法について今回は割愛しまして、私が今回AWSマルチアカウント管理を設計してこの場合どうすればよいのか分からなかった点について述べさせていただきます。

# 参考文献
https://aws.amazon.com/jp/builders-flash/202007/multi-accounts-best-practice/?awsf.filter-name=*all
https://www.sbcr.jp/product/4815609061/
https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html