---
title: "RDSのストレージ選択に気を付けよう"
emoji: "🐁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["aws","rds"]
published: false
---

# 背景
会社のAWSの利用明細を確認すると先々月からRDSの利用費が徐々に上がっていることに気が付きました。
新規にRDSを作成しているとはいえ、いくら何でも高騰し過ぎだったので、調査してみるとAWSの思わぬデフォルト設定で費用が余計にかかっていましたので、どんなことがあったのかここに記すことにしました。
# RDSの料金体系
本題に入る前にまずRDSの料金体系のおさらいです。
RDSの料金はRDSを動かすDBインスタンスとそれに付随するストレージの容量で料金が決まります。

##### 例
- RDSタイプ
  - RDS for MySQL
- DBインスタンスストレージ
  - db.t3.medium
- ストレージ
  - 汎用ストレージ100GiB

###### 一か月利用した場合[^1]
$0.104 * 730h + $0.138 * 100GiB = $89.72
[^1]: 東京リージョンかつシングルAZを想定

ある程度単純化しましたが、オンデマンドで一か月利用した場合、db.t3.mediumでストレージ容量を20GiBにするとこれくらいの金額になります。
ここで注意したいのがストレージの料金体系です。

# ストレージの料金について
RDSで選択できるストレージの種類ですが、以下3種類あります。
- 汎用(SSD)ストレージ
- プロビジョンドIOPS(SSD)ストレージ
- マグネティックストレージ

マグネティックストレージは下位互換サポートのため用意されており、新規にストレージを用意する場合は実質汎用ストレージかプロビジョンドストレージの2択になります。
汎用ストレージは名前の通り、さまざまなユースケースで対応でき料金も先ほど記載したストレージの容量に応じて課金額が決まります。

プロビジョンドIOPSですが、高速のI/O性能を要求される大規模サービスに向いたストレージサービスです。チケット予約システムや金融機関の入出金処理など大量の読み書きかつ低レイテンシーを実現させたいときに利用されるストレージタイプです。
このストレージはストレージのサイズに加えてプロビジョニングしたIOPSに応じて課金されます。

###### プロビジョンドIOPSストレージの料金表[^1]
|  |  |
|---|---|
|ストレージ料金| $0.15/GB  |
|プロビジョンドIOPS料金| $0.12/IOPS |

同じインスタンスタイプ、同じストレージサイズで一か月の課金を比較してみると以下のようになります。
またプロビジョンドIOPSはデフォルト設定では1000が設定されていますので1000で計算します。

$0.104 * 730h + $0.15 * 100GiB + $0.12 * 1000IOPS = $210.92
汎用ストレージの時と比較すると倍以上の値段に差があり、ストレージの料金だけをみれば10倍近い差となります。

背景で書いたとおり、会社のAWSの利用料金の高騰はこのストレージの違いが大きな原因でした。

# 開発環境と本番環境のデフォルト設定
